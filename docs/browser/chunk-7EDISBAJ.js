import{a as me,b as $e,c as We,d as He}from"./chunk-GTD7GOE7.js";import{a as ze}from"./chunk-GRD75GYV.js";import{a as x}from"./chunk-ZQRFGBOX.js";import{$ as Fe,A as D,Aa as ne,B as fe,Ba as ae,C as W,D as u,Da as Re,E as H,F as J,Fa as Be,G as Z,H as h,Ia as Qe,J as K,K as X,L as Y,N as Me,O as Te,P as Ne,Q as ke,S as Ae,T as Ve,V as ee,W as te,X as re,Y as qe,Z as ie,_ as oe,ba as Le,i as ue,ia as Oe,q as Se,r as G,s as R,t as Ue,u as B,v as Q,va as je,w as z,wa as Ge,y as P,z as $}from"./chunk-ZU2ZXMGP.js";import{$a as g,A as ve,Ab as xe,Bb as we,Cb as i,Db as r,Eb as s,Ib as L,Lb as f,N as se,Nb as C,Pc as b,Qb as Ie,Sb as pe,Tb as ce,Tc as De,Ub as de,Wa as ye,Wb as n,Yb as v,Zb as Ee,_a as a,a as he,b as Ce,ca as O,ec as be,fc as Pe,ma as w,na as j,rb as _,tb as l,va as I,wa as E}from"./chunk-RJHPHPNE.js";var at=(e,t)=>t.code;function mt(e,t){e&1&&(i(0,"mat-error",23),n(1," The name is required "),r())}function lt(e,t){e&1&&(i(0,"mat-error",23),n(1," The name must be at least 3 characters "),r())}function st(e,t){e&1&&(i(0,"mat-error",23),n(1," The name must be less than 50 characters "),r())}function pt(e,t){e&1&&(i(0,"mat-error",23),n(1," Last name is required "),r())}function ct(e,t){e&1&&(i(0,"mat-error",23),n(1," Last name must be at least 3 characters "),r())}function dt(e,t){e&1&&(i(0,"mat-error",23),n(1," Last name must be less than 50 characters "),r())}function ut(e,t){if(e&1&&(i(0,"mat-option",12),s(1,"img",24),i(2,"span",25),n(3),r()()),e&2){let c=t.$implicit;l("value",c),a(),Ie("src","https://flagsapi.com/",c.code,"/flat/24.png",ye),l("alt",c.code),a(2),v(" ",c.name," ")}}function ft(e,t){e&1&&(i(0,"mat-error",23),n(1," The country is required "),r())}function gt(e,t){e&1&&(i(0,"mat-error",23),n(1," Phone number is required "),r())}function _t(e,t){e&1&&(i(0,"mat-error",23),n(1," The phone number is invalid "),r())}function ht(e,t){e&1&&(i(0,"mat-error",23),n(1," Address is required "),r())}function Ct(e,t){e&1&&(i(0,"mat-error",23),n(1," Address must be at least 10 characters "),r())}function vt(e,t){e&1&&(i(0,"mat-error",23),n(1," Address must be less than 500 characters "),r())}var Ye=(()=>{let t=class t{constructor(p,m){this.dialogRef=p,this.profile=m,this.form=new Z({firstName:new h("",[u.required,u.minLength(3),u.maxLength(50)]),lastName:new h("",[u.required,u.minLength(3),u.maxLength(50)]),country:new h(null,[u.required]),phoneNumber:new h("",[u.required,x.phoneNumberWithAreaCode()]),address:new h("",[u.required,u.minLength(10),u.maxLength(500)])}),this.countries=me}ngOnInit(){this.form.patchValue({firstName:this.profile.firstName,lastName:this.profile.lastName,country:this.countries.find(p=>p.name===this.profile.country),phoneNumber:this.profile.phoneNumber,address:this.profile.address})}closeDialog(){this.resetForm(),this.dialogRef.close()}editProfile(){this.form.markAllAsTouched(),!this.form.invalid&&(this.dialogRef.close(Ce(he({},this.form.value),{country:this.form.get("country").value.name})),this.resetForm())}resetForm(){this.form.reset()}selectCountry(){let p=this.form.get("country")?.value?.areaCode;p&&this.form.get("phoneNumber")?.setValue(`(+${p}) `)}};t.\u0275fac=function(m){return new(m||t)(g(G),g(R))},t.\u0275cmp=w({type:t,selectors:[["app-update-current-profile-dialog"]],decls:54,vars:15,consts:[["mat-dialog-title","",1,"mat-dialog-title"],["svgIcon","card-account-details",1,"mr-2"],[1,"flex-spacer"],["mat-icon-button","",3,"click"],["svgIcon","close"],[1,"py-2","form",3,"formGroup"],["appearance","outline","color","primary",1,"mat-form-field"],["matInput","","type","text","placeholder","Name...","formControlName","firstName"],["matPrefix","","svgIcon","account-box"],["class","mat-error",4,"ngIf"],["matInput","","type","text","placeholder","Apellido...","formControlName","lastName"],["formControlName","country",3,"selectionChange"],[3,"value"],["matPrefix","","svgIcon","flag"],["matInput","","type","text","placeholder","Seleccione un pa\xEDs...","formControlName","phoneNumber","appPhoneNumber","",3,"readonly","country"],["matPrefix","","svgIcon","phone"],["appearance","outline","color","primary","id","address-field",1,"mat-form-field"],["matInput","","type","text","placeholder","Address...","formControlName","address","rows","3"],["matPrefix","","svgIcon","map-marker"],["align","end",1,"mat-dialog-actions"],["mat-button","","color","basic",3,"click"],["mat-flat-button","","color","primary",3,"click"],["svgIcon","pencil"],[1,"mat-error"],[1,"country-img",3,"src","alt"],[1,"country-name"]],template:function(m,o){if(m&1&&(i(0,"h2",0),s(1,"mat-icon",1),n(2," Edit profile "),s(3,"div",2),i(4,"button",3),f("click",function(){return o.closeDialog()}),s(5,"mat-icon",4),r()(),i(6,"mat-dialog-content")(7,"form",5)(8,"mat-form-field",6)(9,"mat-label"),n(10," Name "),r(),s(11,"input",7)(12,"mat-icon",8),_(13,mt,2,0,"mat-error",9)(14,lt,2,0,"mat-error",9)(15,st,2,0,"mat-error",9),r(),i(16,"mat-form-field",6)(17,"mat-label"),n(18," Last name "),r(),s(19,"input",10)(20,"mat-icon",8),_(21,pt,2,0,"mat-error",9)(22,ct,2,0,"mat-error",9)(23,dt,2,0,"mat-error",9),r(),i(24,"mat-form-field",6)(25,"mat-label"),n(26," Country "),r(),i(27,"mat-select",11),f("selectionChange",function(){return o.selectCountry()}),xe(28,ut,4,5,"mat-option",12,at),r(),s(30,"mat-icon",13),_(31,ft,2,0,"mat-error",9),r(),i(32,"mat-form-field",6)(33,"mat-label"),n(34," Phone number "),r(),s(35,"input",14)(36,"mat-icon",15),_(37,gt,2,0,"mat-error",9)(38,_t,2,0,"mat-error",9),r(),i(39,"mat-form-field",16)(40,"mat-label"),n(41," Address "),r(),s(42,"textarea",17)(43,"mat-icon",18),_(44,ht,2,0,"mat-error",9)(45,Ct,2,0,"mat-error",9)(46,vt,2,0,"mat-error",9),r()()(),i(47,"mat-dialog-actions",19)(48,"button",20),f("click",function(){return o.closeDialog()}),s(49,"mat-icon",4),n(50," Cancel "),r(),i(51,"button",21),f("click",function(){return o.editProfile()}),s(52,"mat-icon",22),n(53," Edit "),r()()),m&2){let d,y,S,U,M,T,N,k,A,V,q,F,ge,_e;a(7),l("formGroup",o.form),a(6),l("ngIf",(d=o.form.get("firstName"))==null?null:d.hasError("required")),a(),l("ngIf",(y=o.form.get("firstName"))==null?null:y.hasError("minlength")),a(),l("ngIf",(S=o.form.get("firstName"))==null?null:S.hasError("maxlength")),a(6),l("ngIf",(U=o.form.get("lastName"))==null?null:U.hasError("required")),a(),l("ngIf",(M=o.form.get("lastName"))==null?null:M.hasError("minlength")),a(),l("ngIf",(T=o.form.get("lastName"))==null?null:T.hasError("maxlength")),a(5),we(o.countries),a(3),l("ngIf",(N=o.form.get("country"))==null?null:N.hasError("required")),a(4),l("readonly",!((k=o.form.get("country"))!=null&&k.value))("country",(A=o.form.get("country"))==null?null:A.value),a(2),l("ngIf",(V=o.form.get("phoneNumber"))==null?null:V.hasError("required")),a(),l("ngIf",(q=o.form.get("phoneNumber"))==null?null:q.hasError("phoneNumberWithAreaCode")),a(6),l("ngIf",(F=o.form.get("address"))==null?null:F.hasError("required")),a(),l("ngIf",(ge=o.form.get("address"))==null?null:ge.hasError("minlength")),a(),l("ngIf",(_e=o.form.get("address"))==null?null:_e.hasError("maxlength"))}},dependencies:[b,Re,P,$,D,B,z,Q,ie,ee,te,re,oe,Oe,Se,K,W,H,J,X,Y],styles:[".form[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;column-gap:16px}@media (width < 640px){.form[_ngcontent-%COMP%]{grid-template-columns:1fr}}.country-img[_ngcontent-%COMP%]{position:absolute}.country-name[_ngcontent-%COMP%]{margin-left:30px}#password-toggle[_ngcontent-%COMP%]{display:flex;justify-content:center}@media (width >= 640px){#address-field[_ngcontent-%COMP%], #password-toggle[_ngcontent-%COMP%]{grid-column:1/span 2}}"]});let e=t;return e})();function yt(e,t){e&1&&(i(0,"mat-error",20),n(1," Email is required "),r())}function xt(e,t){e&1&&(i(0,"mat-error",20),n(1," The email is not valid "),r())}function wt(e,t){e&1&&(i(0,"mat-error",20),n(1," The email must have a maximum of 320 characters "),r())}function It(e,t){if(e&1){let c=L();i(0,"button",21),f("click",function(){I(c);let m=C();return E(m.togglePasswordVisibility())}),s(1,"mat-icon",22),r()}if(e&2){let c=C();a(),l("svgIcon",c.passwordInputType==="password"?"eye":"eye-off")}}function Et(e,t){e&1&&(i(0,"mat-error",20),n(1," Password is required "),r())}function bt(e,t){e&1&&(i(0,"mat-error",20),n(1," Password must be at least 10 characters "),r())}function Pt(e,t){e&1&&(i(0,"mat-error",20),n(1," The password must have a maximum of 100 characters "),r())}function Dt(e,t){e&1&&(i(0,"mat-error",20),n(1," Password must have at least one number "),r())}function St(e,t){e&1&&(i(0,"mat-error",20),n(1," Password must have at least one uppercase letter "),r())}function Ut(e,t){e&1&&(i(0,"mat-error",20),n(1," Password must have at least one lowercase letter "),r())}function Mt(e,t){e&1&&(i(0,"mat-error",20),n(1," Password must have at least one special character "),r())}function Tt(e,t){if(e&1){let c=L();i(0,"button",21),f("click",function(){I(c);let m=C();return E(m.togglePasswordVisibility())}),s(1,"mat-icon",22),r()}if(e&2){let c=C();a(),l("svgIcon",c.passwordInputType==="password"?"eye":"eye-off")}}function Nt(e,t){e&1&&(i(0,"mat-error",20),n(1," Confirmation is required "),r())}function kt(e,t){e&1&&(i(0,"mat-error",20),n(1," The confirmation must match the password "),r())}var et=(()=>{let t=class t{constructor(p,m){this.dialogRef=p,this.user=m,this.form=new Z({email:new h("",[u.required,u.email,u.maxLength(320)]),updatePassword:new h(!1),password:new h("",[u.required,u.minLength(10),u.maxLength(100),x.hasLowercase(),x.hasUppercase(),x.hasNumber(),x.hasSpecialCharacter()]),confirmPassword:new h("",[u.required])}),this.passwordInputType="password"}ngOnInit(){this.form.patchValue({email:this.user.email}),this.togglePasswordUpdate(),this.startPasswordMatchValidation()}closeDialog(){this.resetForm(),this.dialogRef.close()}editUser(){this.form.markAllAsTouched(),!this.form.invalid&&(this.dialogRef.close({email:this.form.get("email").value,password:this.form.get("updatePassword").value?this.form.get("password").value:void 0}),this.resetForm())}resetForm(){this.form.reset()}togglePasswordUpdate(){let p=this.form.get("updatePassword").value;this.form.get("password").reset(),this.form.get("confirmPassword").reset(),p?(this.form.get("password").enable(),this.form.get("confirmPassword").enable()):(this.form.get("password").disable(),this.form.get("confirmPassword").disable())}togglePasswordVisibility(){this.passwordInputType=this.passwordInputType==="password"?"text":"password"}passwordMatchValidation(){this.form.get("password").value!==this.form.get("confirmPassword").value&&this.form.get("confirmPassword").setErrors({passwordMatch:!0})}startPasswordMatchValidation(){this.form.get("confirmPassword").valueChanges.subscribe(()=>this.passwordMatchValidation())}};t.\u0275fac=function(m){return new(m||t)(g(G),g(R))},t.\u0275cmp=w({type:t,selectors:[["app-update-current-user-dialog"]],decls:46,vars:17,consts:[["mat-dialog-title","",1,"mat-dialog-title"],["svgIcon","account",1,"mr-2"],[1,"flex-spacer"],["mat-icon-button","",3,"click"],["svgIcon","close"],[1,"py-2","form",3,"formGroup"],["appearance","outline","color","primary",1,"mat-form-field"],["matInput","","type","text","placeholder","Email...","formControlName","email"],["matPrefix","","svgIcon","email"],["class","mat-error",4,"ngIf"],["color","primary","formControlName","updatePassword","id","password-toggle",1,"mb-3",3,"change"],["matInput","","placeholder","Password...","formControlName","password",3,"type"],["matPrefix","","svgIcon","lock"],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],["matInput","","placeholder","Confirm Password...","formControlName","confirmPassword",3,"type"],["matPrefix","","svgIcon","lock-check"],["align","end",1,"mat-dialog-actions"],["mat-button","","color","basic",3,"click"],["mat-flat-button","","color","primary",3,"click"],["svgIcon","pencil"],[1,"mat-error"],["mat-icon-button","","matSuffix","",3,"click"],[3,"svgIcon"]],template:function(m,o){if(m&1&&(i(0,"h2",0),s(1,"mat-icon",1),n(2," Edit User "),s(3,"div",2),i(4,"button",3),f("click",function(){return o.closeDialog()}),s(5,"mat-icon",4),r()(),i(6,"mat-dialog-content")(7,"form",5)(8,"mat-form-field",6)(9,"mat-label"),n(10," Email "),r(),s(11,"input",7)(12,"mat-icon",8),_(13,yt,2,0,"mat-error",9)(14,xt,2,0,"mat-error",9)(15,wt,2,0,"mat-error",9),r(),i(16,"mat-slide-toggle",10),f("change",function(){return o.togglePasswordUpdate()}),n(17," Do you want to update the user's password? "),r(),i(18,"mat-form-field",6)(19,"mat-label"),n(20," Password "),r(),s(21,"input",11)(22,"mat-icon",12),_(23,It,2,1,"button",13)(24,Et,2,0,"mat-error",9)(25,bt,2,0,"mat-error",9)(26,Pt,2,0,"mat-error",9)(27,Dt,2,0,"mat-error",9)(28,St,2,0,"mat-error",9)(29,Ut,2,0,"mat-error",9)(30,Mt,2,0,"mat-error",9),r(),i(31,"mat-form-field",6)(32,"mat-label"),n(33," Confirm Password "),r(),s(34,"input",14)(35,"mat-icon",15),_(36,Tt,2,1,"button",13)(37,Nt,2,0,"mat-error",9)(38,kt,2,0,"mat-error",9),r()()(),i(39,"mat-dialog-actions",16)(40,"button",17),f("click",function(){return o.closeDialog()}),s(41,"mat-icon",4),n(42," Cancel "),r(),i(43,"button",18),f("click",function(){return o.editUser()}),s(44,"mat-icon",19),n(45," Edit "),r()()),m&2){let d,y,S,U,M,T,N,k,A,V,q,F;a(7),l("formGroup",o.form),a(6),l("ngIf",(d=o.form.get("email"))==null?null:d.hasError("required")),a(),l("ngIf",(y=o.form.get("email"))==null?null:y.hasError("email")),a(),l("ngIf",(S=o.form.get("email"))==null?null:S.hasError("maxLength")),a(6),l("type",o.passwordInputType),a(2),l("ngIf",o.form.get("updatePassword").value),a(),l("ngIf",(U=o.form.get("password"))==null?null:U.hasError("required")),a(),l("ngIf",(M=o.form.get("password"))==null?null:M.hasError("minlength")),a(),l("ngIf",(T=o.form.get("password"))==null?null:T.hasError("maxlength")),a(),l("ngIf",(N=o.form.get("password"))==null?null:N.hasError("hasNumber")),a(),l("ngIf",(k=o.form.get("password"))==null?null:k.hasError("hasUppercase")),a(),l("ngIf",(A=o.form.get("password"))==null?null:A.hasError("hasLowercase")),a(),l("ngIf",(V=o.form.get("password"))==null?null:V.hasError("hasSpecialCharacter")),a(4),l("type",o.passwordInputType),a(2),l("ngIf",o.form.get("updatePassword").value),a(),l("ngIf",(q=o.form.get("confirmPassword"))==null?null:q.hasError("required")),a(),l("ngIf",(F=o.form.get("confirmPassword"))==null?null:F.hasError("passwordMatch"))}},dependencies:[b,P,$,D,B,z,Q,ie,ee,te,re,qe,oe,je,K,W,H,J,X,Y],styles:[".form[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;column-gap:16px}#password-toggle[_ngcontent-%COMP%]{display:flex;justify-content:center}"]});let e=t;return e})();function At(e,t){if(e&1){let c=L();i(0,"main",2)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title",3),s(4,"mat-icon",4),n(5," User "),r()(),i(6,"mat-card-content")(7,"div",5)(8,"p",6),s(9,"mat-icon",7),n(10),r(),i(11,"p",6),s(12,"mat-icon",8),n(13),be(14,"userRole"),r()()(),i(15,"mat-card-actions",9)(16,"button",10),f("click",function(){I(c);let m=C();return E(m.editUser())}),s(17,"mat-icon",11),n(18," Edit user "),r()()(),i(19,"mat-card")(20,"mat-card-header")(21,"mat-card-title",3),s(22,"mat-icon",12),n(23," Profile "),r()(),i(24,"mat-card-content")(25,"div",5)(26,"p",6),s(27,"mat-icon",13),n(28),r(),i(29,"p",6),s(30,"mat-icon",14),n(31),r(),i(32,"p",6),s(33,"mat-icon",15),n(34),r(),i(35,"p",6),s(36,"mat-icon",16),n(37),r()()(),i(38,"mat-card-actions",9)(39,"button",10),f("click",function(){I(c);let m=C();return E(m.editProfile())}),s(40,"mat-icon",11),n(41," Edit Profile "),r()()()()}if(e&2){let c=C();a(10),v(" ",c.user.email," "),a(3),v(" ",Pe(14,7,c.user.role)," "),a(15),Ee(" ",c.profile.firstName," ",c.profile.lastName," "),a(3),v(" ",c.profile.phoneNumber," "),a(3),v(" ",c.profile.country," "),a(3),v(" ",c.profile.address," ")}}function Vt(e,t){if(e&1&&s(0,"app-loading-view",17),e&2){let c=C();l("state",c.viewState)}}var tt=(()=>{let t=class t{constructor(p,m,o,d,y){this.peopleService=p,this.usersService=m,this.peopleMapper=o,this.usersMapper=d,this.dialog=y,this.viewState="loading",this.countries=me}ngOnInit(){this.getData()}getData(){this.viewState="loading",ve([this.peopleService.getCurrentAuthenticatedPerson(),this.usersService.getCurrentAuthenticatedUser()]).subscribe({next:([p,m])=>{this.profile=this.peopleMapper.mapGetCurrentAuthenticatedPersonResponseDtoToModel(p),this.user=this.usersMapper.mapGetCurrentUserResonseDtoToModel(m),this.viewState="ready"},error:p=>{this.viewState="error"}})}editProfile(){this.dialog.open(Ye,{width:fe.lg,data:this.profile}).afterClosed().subscribe(m=>{m&&(this.loadingDialog.open(),this.peopleService.updateCurrentAuthenticatedPerson(m).pipe(se(()=>this.loadingDialog.close())).subscribe({next:()=>{this.profile=m},error:o=>{this.errorDialog.open("Ocurrio un error al actualizar el perfil",o.message)}}))})}editUser(){this.dialog.open(et,{width:fe.md,data:this.user}).afterClosed().subscribe(m=>{m&&(this.loadingDialog.open(),this.usersService.updateCurrentUser(m).pipe(se(()=>this.loadingDialog.close())).subscribe({next:()=>{this.user.email=m.email},error:o=>{this.errorDialog.open("Ocurrio un error al actualizar el usuario",o.message)}}))})}};t.\u0275fac=function(m){return new(m||t)(g(We),g(ze),g(He),g($e),g(Ue))},t.\u0275cmp=w({type:t,selectors:[["app-profile"]],viewQuery:function(m,o){if(m&1&&(pe(ne,5),pe(ae,5)),m&2){let d;ce(d=de())&&(o.loadingDialog=d.first),ce(d=de())&&(o.errorDialog=d.first)}},decls:5,vars:2,consts:[["class","mx-3 my-3",4,"ngIf"],["view","perfil",3,"state",4,"ngIf"],[1,"mx-3","my-3"],[1,"inline-flex-aligned"],["svgIcon","account",1,"ml-3","mr-2"],[1,"px-3","mt-2"],[1,"flex-aligned"],["svgIcon","email",1,"mr-1"],["svgIcon","shield-account",1,"mr-1"],["align","end"],["mat-flat-button","","color","primary",1,"w-100","mx-3",3,"click"],["svgIcon","pencil"],["svgIcon","card-account-details",1,"ml-3","mr-2"],["svgIcon","account",1,"mr-1"],["svgIcon","phone",1,"mr-1"],["svgIcon","flag",1,"mr-1"],["svgIcon","map-marker",1,"mr-1"],["view","perfil",3,"state"]],template:function(m,o){m&1&&(s(0,"app-navbar"),_(1,At,42,9,"main",0)(2,Vt,1,1,"app-loading-view",1),s(3,"app-error-dialog")(4,"app-loading-dialog")),m&2&&(a(),l("ngIf",o.viewState==="ready"),a(),l("ngIf",o.viewState!=="ready"))},dependencies:[b,Fe,Le,ne,ae,P,D,Te,Ae,ke,Ve,Ne,Be],styles:["mat-card[_ngcontent-%COMP%]{border-radius:25px;box-shadow:0 0 12px #0003}main[_ngcontent-%COMP%]{display:grid;gap:16px;grid-template-columns:1fr}@media (width >= 960px){main[_ngcontent-%COMP%]{grid-template-columns:1fr 2fr}}mat-card-content[_ngcontent-%COMP%]{display:grid}mat-card-actions[_ngcontent-%COMP%]{flex-grow:1;align-items:end;margin-bottom:16px}"]});let e=t;return e})();var qt=[{path:"",component:tt}],rt=(()=>{let t=class t{};t.\u0275fac=function(m){return new(m||t)},t.\u0275mod=j({type:t}),t.\u0275inj=O({imports:[ue.forChild(qt),ue]});let e=t;return e})();var Ur=(()=>{let t=class t{};t.\u0275fac=function(m){return new(m||t)},t.\u0275mod=j({type:t}),t.\u0275inj=O({imports:[De,rt,Qe,Ge,Me]});let e=t;return e})();export{Ur as ProfileModule};
