import{a as we}from"./chunk-GJQJ4ZCE.js";import{a as Pe}from"./chunk-2366YRB6.js";import{a as ve}from"./chunk-OXE7SYZI.js";import{$ as ne,A as E,Aa as k,B as N,Ba as R,Ea as ge,Ga as Ce,Ha as xe,Ia as Me,O as Y,P as ee,Q as te,T as ie,ba as ae,i as V,ka as oe,la as re,ma as me,na as ce,oa as se,pa as le,qa as pe,r as q,ra as de,s as U,sa as ue,t as Z,ta as he,u as J,ua as fe,v as K,w as W,wa as _e,y as X,z as T}from"./chunk-ZU2ZXMGP.js";import{$a as u,Cb as a,Db as o,Eb as s,Fb as _,Gb as g,Ib as O,Lb as f,N as H,Nb as C,Pc as L,Rc as I,Sb as A,Sc as Q,Tb as B,Tc as G,Ub as j,Wb as c,Yb as v,Zb as b,_a as l,ca as P,dc as F,ec as x,fc as $,gc as M,ma as w,na as D,rb as d,tb as h,va as S,wa as y}from"./chunk-RJHPHPNE.js";var De=(()=>{let t=class t{constructor(i,n){this.dialogRef=i,this.purchase=n}closeDialog(){this.dialogRef.close()}deletePurchase(){this.dialogRef.close(this.purchase)}};t.\u0275fac=function(n){return new(n||t)(u(q),u(U))},t.\u0275cmp=w({type:t,selectors:[["app-delete-purchase-dialog"]],decls:22,vars:5,consts:[["mat-dialog-title","",1,"mat-dialog-title"],["svgIcon","package-variant-closed-check",1,"mr-2"],[1,"flex-spacer"],["mat-icon-button","",3,"click"],["svgIcon","close"],[1,"text-center","pt-2"],["svgIcon","message-alert","color","warn",1,"icon-lg"],[1,"text-center"],[1,"text-warn"],["align","end",1,"mat-dialog-actions"],["mat-button","","color","basic",3,"click"],["mat-flat-button","","color","primary",3,"click"],["svgIcon","delete"]],template:function(n,m){n&1&&(a(0,"h2",0),s(1,"mat-icon",1),c(2," Delete purchase "),s(3,"div",2),a(4,"button",3),f("click",function(){return m.closeDialog()}),s(5,"mat-icon",4),o()(),a(6,"mat-dialog-content")(7,"p",5),s(8,"mat-icon",6),o(),a(9,"p",7),c(10," Are you sure you want to delete the purchase made by "),a(11,"span",8),c(12),x(13,"date"),o(),c(14,"? "),o()(),a(15,"mat-dialog-actions",9)(16,"button",10),f("click",function(){return m.closeDialog()}),s(17,"mat-icon",4),c(18," Cancle "),o(),a(19,"button",11),f("click",function(){return m.deletePurchase()}),s(20,"mat-icon",12),c(21," Eliminate "),o()()),n&2&&(l(12),b("",m.purchase.user.email," el ",M(13,2,m.purchase.purchaseDate,"dd/MM/yyyy"),""))},dependencies:[X,T,E,J,W,K,I]});let e=t;return e})();var ke=()=>[10,15,20];function Re(e,t){e&1&&(a(0,"th",19),c(1,"Fecha"),o())}function Oe(e,t){if(e&1&&(a(0,"td",20),c(1),x(2,"date"),o()),e&2){let r=t.$implicit;l(),v(" ",M(2,1,r.purchaseDate,"dd/MM/yyyy")," ")}}function Ae(e,t){e&1&&(a(0,"th",19),c(1,"Total"),o())}function Be(e,t){if(e&1&&(a(0,"td",20),c(1),x(2,"number"),o()),e&2){let r=t.$implicit;l(),v("\u20B9 ",M(2,1,r.total,"1.2-2"),"")}}function je(e,t){e&1&&(a(0,"th",19),c(1,"Pagado con"),o())}function Ve(e,t){if(e&1&&(a(0,"td",20),c(1),x(2,"maskedCardNumber"),o()),e&2){let r=t.$implicit,i=C(2);l(),b(" ",i.cardsService.getCardBrandByNumber(r.paymentCard.number).brand," ",M(2,2,r.paymentCard.number,9)," ")}}function Ne(e,t){e&1&&(a(0,"th",19),c(1,"Productos"),o())}function ze(e,t){if(e&1&&(a(0,"td",20),c(1),x(2,"countPurchasedProducts"),o()),e&2){let r=t.$implicit;l(),v(" ",$(2,1,r)," producto/s ")}}function He(e,t){e&1&&(a(0,"th",19),c(1,"Usuario"),o())}function Fe(e,t){if(e&1&&(a(0,"td",20),c(1),o()),e&2){let r=t.$implicit;l(),v(" ",r.user.email," ")}}function $e(e,t){e&1&&(a(0,"th",19),c(1,"Acciones"),o())}function Le(e,t){if(e&1){let r=O();a(0,"td",20)(1,"button",21),f("click",function(){let n=S(r).$implicit,m=C(2);return y(m.viewProducts(n))}),s(2,"mat-icon",22),o(),a(3,"button",23),f("click",function(){let n=S(r).$implicit,m=C(2);return y(m.deletePurchase(n))}),s(4,"mat-icon",24),o()()}}function Qe(e,t){e&1&&s(0,"tr",25)}function Ge(e,t){e&1&&s(0,"tr",26)}function qe(e,t){if(e&1){let r=O();a(0,"main",2)(1,"mat-card",3)(2,"mat-card-header")(3,"mat-card-title",4),s(4,"mat-icon",5),c(5," Gestionar compras "),o()(),a(6,"mat-card-content")(7,"div",6)(8,"table",7),_(9,8),d(10,Re,2,0,"th",9)(11,Oe,3,4,"td",10),g(),_(12,11),d(13,Ae,2,0,"th",9)(14,Be,3,4,"td",10),g(),_(15,12),d(16,je,2,0,"th",9)(17,Ve,3,5,"td",10),g(),_(18,13),d(19,Ne,2,0,"th",9)(20,ze,3,3,"td",10),g(),_(21,14),d(22,He,2,0,"th",9)(23,Fe,2,1,"td",10),g(),_(24,15),d(25,$e,2,0,"th",9)(26,Le,5,0,"td",10),g(),d(27,Qe,1,0,"tr",16)(28,Ge,1,0,"tr",17),o()(),a(29,"mat-paginator",18),f("page",function(n){S(r);let m=C();return y(m.selectPage(n))}),o()()()()}if(e&2){let r=C();l(8),h("dataSource",r.tablePurchases),l(19),h("matHeaderRowDef",r.displayedColumns),l(),h("matRowDefColumns",r.displayedColumns),l(),h("pageSizeOptions",F(5,ke))("length",r.purchases.length)}}function Ue(e,t){if(e&1&&s(0,"app-loading-view",27),e&2){let r=C();h("state",r.viewState)}}var Se=(()=>{let t=class t{constructor(i,n,m,p){this.purchasesService=i,this.purchasesMapper=n,this.cardsService=m,this.dialog=p,this.displayedColumns=["user","date","total","products","payment-info","actions"],this.viewState="loading",this.pageSize=10,this.pageIndex=0}ngOnInit(){this.getPurchases()}getPurchases(){this.viewState="loading",this.purchasesService.getAllPurchases().subscribe({next:i=>{this.purchases=this.purchasesMapper.mapGetAllPurchasesToModel(i),this.renderTable(),this.viewState="ready"},error:i=>{this.viewState="error"}})}renderTable(){let i=this.pageIndex*this.pageSize,n=i+this.pageSize;this.tablePurchases=this.purchases.slice(i,n)}selectPage(i){this.pageSize=i.pageSize,this.pageIndex=i.pageIndex}viewProducts(i){let n=this.dialog.open(Ce,{width:N.md,data:i})}deletePurchase(i){this.dialog.open(De,{width:N.md,data:i}).afterClosed().subscribe(m=>{m&&(this.loadingDialog.open(),this.purchasesService.deletePurchase(i.id).pipe(H(()=>this.loadingDialog.close())).subscribe({next:()=>{this.purchases=this.purchases.filter(p=>p.id!==i.id),this.renderTable()},error:p=>{this.errorDialog.open("Ocurrio un error al eliminar la compra",p.message)}}))})}};t.\u0275fac=function(n){return new(n||t)(u(Pe),u(we),u(ve),u(Z))},t.\u0275cmp=w({type:t,selectors:[["app-manage-purchases"]],viewQuery:function(n,m){if(n&1&&(A(k,5),A(R,5)),n&2){let p;B(p=j())&&(m.loadingDialog=p.first),B(p=j())&&(m.errorDialog=p.first)}},decls:5,vars:2,consts:[["class","mx-3 my-3",4,"ngIf"],["view","compras",3,"state",4,"ngIf"],[1,"mx-3","my-3"],[1,"mx-4","mt-5"],[1,"inline-flex-aligned"],["svgIcon","package-variant-closed-check",1,"ml-3","mr-2"],["id","table-responsive"],["mat-table","",3,"dataSource"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","total"],["matColumnDef","payment-info"],["matColumnDef","products"],["matColumnDef","user"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",1,"mt-3",3,"page","pageSizeOptions","length"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","primary",3,"click"],["svgIcon","package-variant"],["mat-icon-button","","color","warn",3,"click"],["svgIcon","delete"],["mat-header-row",""],["mat-row",""],["view","compras",3,"state"]],template:function(n,m){n&1&&(s(0,"app-navbar"),d(1,qe,30,6,"main",0)(2,Ue,1,1,"app-loading-view",1),s(3,"app-error-dialog")(4,"app-loading-dialog")),n&2&&(l(),h("ngIf",m.viewState==="ready"),l(),h("ngIf",m.viewState!=="ready"))},dependencies:[L,ne,ae,k,R,T,E,Y,te,ie,ee,oe,me,pe,ce,re,de,se,le,ue,he,fe,Q,I,ge,xe],styles:["mat-card[_ngcontent-%COMP%]{border-radius:25px;box-shadow:0 0 12px #0003}mat-card-content[_ngcontent-%COMP%]   #table-responsive[_ngcontent-%COMP%]{width:100%;overflow-x:scroll}.mat-column-payment-info[_ngcontent-%COMP%], .mat-column-total[_ngcontent-%COMP%], .mat-column-products[_ngcontent-%COMP%]{white-space:nowrap}.mat-column-actions[_ngcontent-%COMP%]{text-align:center;width:150px;white-space:nowrap}"]});let e=t;return e})();var Ze=[{path:"",component:Se}],ye=(()=>{let t=class t{};t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=D({type:t}),t.\u0275inj=P({imports:[V.forChild(Ze),V]});let e=t;return e})();var bt=(()=>{let t=class t{};t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=D({type:t}),t.\u0275inj=P({imports:[G,ye,Me,_e]});let e=t;return e})();export{bt as ManagePurchasesModule};
