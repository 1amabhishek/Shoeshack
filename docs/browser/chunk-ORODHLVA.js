import{a as St,b as Pt,c as bt}from"./chunk-UWTXMKMF.js";import"./chunk-ZQRFGBOX.js";import{a as wt}from"./chunk-2366YRB6.js";import{a as Mt}from"./chunk-OXE7SYZI.js";import{$ as gt,A as W,Aa as y,Ba as x,C as X,D as C,E as Y,Ea as yt,F as Z,G as tt,H as E,Ia as xt,J as et,K as it,L as rt,N as at,O as ot,P as nt,Q as mt,S as ct,T as lt,V as pt,W as st,X as dt,Z as ft,_ as ut,ba as vt,g as z,h as U,i as v,ia as Ct,q as H,wa as ht,x as J,y as K,za as _t}from"./chunk-ZU2ZXMGP.js";import{$a as f,Ab as M,Bb as S,Cb as c,Db as o,Eb as d,Ib as q,Lb as O,N as D,Nb as u,Pc as Q,Sb as w,Sc as R,Tb as P,Tc as $,Ub as b,Wb as p,Xb as A,Yb as L,_a as l,a as T,b as V,ca as h,ec as I,fc as B,gc as G,ma as F,na as _,rb as g,tb as s,va as N,wa as j,yb as k}from"./chunk-RJHPHPNE.js";var It=(t,e)=>e.id;function Ft(t,e){if(t&1&&(c(0,"mat-option",15),p(1),I(2,"maskedCardNumber"),o()),t&2){let n=e.$implicit;s("value",n),l(),A(B(2,2,n.number))}}function Nt(t,e){t&1&&(c(0,"mat-error",23),p(1," The card is required "),o())}function jt(t,e){if(t&1&&d(0,"app-payment-card",24),t&2){let n=u().$implicit;s("card",n)("enableActions",!1)}}function kt(t,e){if(t&1&&g(0,jt,1,2,"app-payment-card",24),t&2){let n,r=e.$implicit,i=u(2);k(0,r.id===((n=i.form.get("card"))==null||n.value==null?null:n.value.id)?0:-1)}}function qt(t,e){t&1&&(c(0,"mat-error",23),p(1," The CVV is required "),o())}function Ot(t,e){t&1&&(c(0,"mat-error",23),p(1," The CVV must have at least 3 characters "),o())}function At(t,e){t&1&&(c(0,"mat-error",23),p(1," The CVV can have a maximum of 3 characters "),o())}function Lt(t,e){if(t&1){let n=q();c(0,"main",2)(1,"div")(2,"mat-card",3)(3,"mat-card-header",4)(4,"mat-card-title",5),d(5,"mat-icon",6),p(6," Pay "),o()(),c(7,"mat-card-content")(8,"div",7)(9,"button",8),d(10,"mat-icon",9),p(11," Back to Cart "),o()(),c(12,"div",10),p(13," Amount to Pay "),c(14,"span",11),p(15),I(16,"number"),o()(),c(17,"form",12)(18,"mat-form-field",13)(19,"mat-label"),p(20," Card "),o(),c(21,"mat-select",14),M(22,Ft,3,4,"mat-option",15,It),o(),d(24,"mat-icon",16),g(25,Nt,2,0,"mat-error",17),o(),c(26,"div",18),M(27,kt,1,1,null,null,It),o(),c(29,"mat-form-field",13)(30,"mat-label"),p(31," CVV "),o(),d(32,"input",19)(33,"mat-icon",20),g(34,qt,2,0,"mat-error",17)(35,Ot,2,0,"mat-error",17)(36,At,2,0,"mat-error",17),o()()(),c(37,"mat-card-actions",4)(38,"button",21),O("click",function(){N(n);let i=u();return j(i.pay())}),d(39,"mat-icon",22),p(40," Pay "),o()()()()()}if(t&2){let n,r,i,m,a=u();l(15),L("\u20B9 ",G(16,7,a.total,"1.2-2"),""),l(2),s("formGroup",a.form),l(5),S(a.cards),l(3),s("ngIf",(n=a.form.get("card"))==null?null:n.hasError("required")),l(2),S(a.cards),l(7),s("ngIf",(r=a.form.get("cvv"))==null?null:r.hasError("required")),l(),s("ngIf",(i=a.form.get("cvv"))==null?null:i.hasError("minlength")),l(),s("ngIf",(m=a.form.get("cvv"))==null?null:m.hasError("maxlength")),l(2),s("disabled",a.form.invalid||a.cart.items.length===0)}}function Bt(t,e){if(t&1&&d(0,"app-loading-view",25),t&2){let n=u();s("state",n.viewState)}}var Tt=(()=>{let e=class e{constructor(r,i,m,a,Dt){this.cartService=r,this.cardsService=i,this.cardsMapper=m,this.purchasesService=a,this.router=Dt,this.form=new tt({card:new E(null,[C.required]),cvv:new E("",[C.required,C.minLength(3),C.maxLength(3)])}),this.viewState="loading"}ngOnInit(){this.getCart(),this.getCards()}getCart(){this.cart=this.cartService.getCart(),this.total=this.cartService.getTotal()}getCards(){this.viewState="loading",this.cardsService.getAllPaymentCardsForCurrentUser().subscribe({next:r=>{this.cards=this.cardsMapper.mapGetAllPaymentCardsForUserToModel(r),this.form.get("card")?.setValue(this.cards[0]),this.viewState="ready"},error:r=>{this.viewState="error"}})}pay(){if(this.form.invalid)return;let r=this.form.get("card").value,i=this.form.get("cvv").value;this.loadingDialog.open(),this.purchasesService.createPurchase({paymentDetails:V(T({},r),{cvv:i}),total:this.total,products:this.cart.items.map(m=>({id:m.product.id,quantity:m.quantity}))}).pipe(D(()=>this.loadingDialog.close())).subscribe({next:()=>{this.cartService.clearCart(),this.router.navigateByUrl("/purchases?success=true")},error:m=>{this.errorDialog.open("Ocurrio un error al realizar el pago",m.message),this.loadingDialog.close()}})}};e.\u0275fac=function(i){return new(i||e)(f(J),f(Mt),f(St),f(wt),f(z))},e.\u0275cmp=F({type:e,selectors:[["app-payment"]],viewQuery:function(i,m){if(i&1&&(w(y,5),w(x,5)),i&2){let a;P(a=b())&&(m.loadingDialog=a.first),P(a=b())&&(m.errorDialog=a.first)}},decls:5,vars:2,consts:[["class","mt-4",4,"ngIf"],["view","payment information",3,"state",4,"ngIf"],[1,"mt-4"],[1,"mx-3"],[1,"justify-center"],[1,"inline-flex-aligned"],["svgIcon","account-credit-card",1,"mr-2"],[1,"text-center"],["mat-button","","color","primary","routerLink","/cart"],["svgIcon","arrow-left"],[1,"inline-flex-aligned","justify-center","text-muted","mt-3"],[1,"text-center","text-primary","ml-3","total"],[1,"mt-5","mb-2","form",3,"formGroup"],["appearance","outline","color","primary",1,"mat-form-field"],["formControlName","card"],[3,"value"],["matPrefix","","svgIcon","credit-card"],["class","mat-error",4,"ngIf"],[1,"flex-aligned","justify-center"],["matInput","","type","password","placeholder","CVV...","formControlName","cvv","appCardCvv",""],["matPrefix","","svgIcon","credit-card-chip"],["mat-raised-button","","color","primary",1,"w-100",3,"click","disabled"],["svgIcon","credit-card-check"],[1,"mat-error"],[3,"card","enableActions"],["view","payment information",3,"state"]],template:function(i,m){i&1&&(d(0,"app-navbar"),g(1,Lt,41,10,"main",0)(2,Bt,1,1,"app-loading-view",1),d(3,"app-error-dialog")(4,"app-loading-dialog")),i&2&&(l(),s("ngIf",m.viewState==="ready"),l(),s("ngIf",m.viewState!=="ready"))},dependencies:[Q,U,gt,_t,vt,y,x,K,W,ot,ct,mt,lt,nt,ft,pt,st,dt,ut,Ct,H,et,X,Y,Z,it,rt,Pt,R,yt],styles:["main[_ngcontent-%COMP%]{display:grid;width:100%}main[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;max-width:500px;place-self:center}.payment-card[_ngcontent-%COMP%]{background-color:#f5f5f5;border-radius:25px;padding:12px;box-shadow:0 0 12px #0003}.total[_ngcontent-%COMP%]{font-size:1.1rem}mat-card-actions[_ngcontent-%COMP%]{padding:0 16px 16px!important;display:grid;grid-template-columns:1fr}mat-card[_ngcontent-%COMP%]{border-radius:25px;box-shadow:0 0 12px #0003;background-color:#f5f5f5}"]});let t=e;return t})();var Gt=[{path:"",component:Tt}],Vt=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=_({type:e}),e.\u0275inj=h({imports:[v.forChild(Gt),v]});let t=e;return t})();var Ie=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=_({type:e}),e.\u0275inj=h({imports:[$,Vt,xt,ht,v,at,bt]});let t=e;return t})();export{Ie as PaymentModule};
