import{a as he}from"./chunk-GJQJ4ZCE.js";import{a as fe}from"./chunk-2366YRB6.js";import{a as ue}from"./chunk-OXE7SYZI.js";import{$ as J,A as L,Aa as y,B as $,Ba as S,Ea as pe,Ga as ce,Ha as le,Ia as de,O as q,P as G,Q as U,T as Z,ba as K,i as R,ka as W,la as X,ma as Y,na as ee,oa as te,pa as ie,qa as ne,ra as ae,sa as re,t as Q,ta as oe,ua as me,wa as se,z as A}from"./chunk-ZU2ZXMGP.js";import{$a as C,Cb as r,Db as o,Eb as d,Fb as f,Gb as h,Ib as I,Lb as b,Nb as _,Pc as H,Rc as k,Sb as T,Sc as z,Tb as E,Tc as F,Ub as O,Wb as p,Yb as v,Zb as N,_a as s,ca as x,dc as V,ec as g,fc as j,gc as P,ma as B,na as w,rb as c,tb as l,va as M,wa as D}from"./chunk-RJHPHPNE.js";var xe=()=>[10,15,20];function we(e,t){e&1&&(r(0,"th",18),p(1,"Date"),o())}function ve(e,t){if(e&1&&(r(0,"td",19),p(1),g(2,"date"),o()),e&2){let a=t.$implicit;s(),v(" ",P(2,1,a.purchaseDate,"dd/MM/yyyy")," ")}}function Pe(e,t){e&1&&(r(0,"th",18),p(1,"Total"),o())}function ye(e,t){if(e&1&&(r(0,"td",19),p(1),g(2,"number"),o()),e&2){let a=t.$implicit;s(),v("\u20B9 ",P(2,1,a.total,"1.2-2"),"")}}function Se(e,t){e&1&&(r(0,"th",18),p(1,"Paid with"),o())}function Me(e,t){if(e&1&&(r(0,"td",19),p(1),g(2,"maskedCardNumber"),o()),e&2){let a=t.$implicit,i=_(2);s(),N(" ",i.cardsService.getCardBrandByNumber(a.paymentCard.number).brand," ",P(2,2,a.paymentCard.number,9)," ")}}function De(e,t){e&1&&(r(0,"th",18),p(1,"Products"),o())}function Ie(e,t){if(e&1&&(r(0,"td",19),p(1),g(2,"countPurchasedProducts"),o()),e&2){let a=t.$implicit;s(),v(" ",j(2,1,a)," producto/s ")}}function be(e,t){e&1&&(r(0,"th",18),p(1,"Actions"),o())}function Te(e,t){if(e&1){let a=I();r(0,"td",19)(1,"button",20),b("click",function(){let n=M(a).$implicit,m=_(2);return D(m.viewProducts(n))}),d(2,"mat-icon",21),o()()}}function Ee(e,t){e&1&&d(0,"tr",22)}function Oe(e,t){e&1&&d(0,"tr",23)}function Re(e,t){if(e&1){let a=I();r(0,"main",2)(1,"mat-card",3)(2,"mat-card-header")(3,"mat-card-title",4),d(4,"mat-icon",5),p(5," My purchases "),o()(),r(6,"mat-card-content")(7,"div",6)(8,"table",7),f(9,8),c(10,we,2,0,"th",9)(11,ve,3,4,"td",10),h(),f(12,11),c(13,Pe,2,0,"th",9)(14,ye,3,4,"td",10),h(),f(15,12),c(16,Se,2,0,"th",9)(17,Me,3,5,"td",10),h(),f(18,13),c(19,De,2,0,"th",9)(20,Ie,3,3,"td",10),h(),f(21,14),c(22,be,2,0,"th",9)(23,Te,3,0,"td",10),h(),c(24,Ee,1,0,"tr",15)(25,Oe,1,0,"tr",16),o()(),r(26,"mat-paginator",17),b("page",function(n){M(a);let m=_();return D(m.selectPage(n))}),o()()()()}if(e&2){let a=_();s(8),l("dataSource",a.tablePurchases),s(16),l("matHeaderRowDef",a.displayedColumns),s(),l("matRowDefColumns",a.displayedColumns),s(),l("pageSizeOptions",V(5,xe))("length",a.purchases.length)}}function Be(e,t){if(e&1&&d(0,"app-loading-view",24),e&2){let a=_();l("state",a.viewState)}}var Ce=(()=>{let t=class t{constructor(i,n,m,u){this.purchasesService=i,this.purchasesMapper=n,this.cardsService=m,this.dialog=u,this.displayedColumns=["date","total","products","payment-info","actions"],this.viewState="loading",this.pageSize=10,this.pageIndex=0}ngOnInit(){this.getPurchases()}getPurchases(){this.viewState="loading",this.purchasesService.getAllPurchasesForCurrentUser().subscribe({next:i=>{this.purchases=this.purchasesMapper.mapGetPurchasesForCurrentUserToModel(i),this.renderTable(),this.viewState="ready"},error:i=>{this.viewState="error"}})}renderTable(){let i=this.pageIndex*this.pageSize,n=i+this.pageSize;this.tablePurchases=this.purchases.slice(i,n)}selectPage(i){this.pageSize=i.pageSize,this.pageIndex=i.pageIndex}viewProducts(i){let n=this.dialog.open(ce,{width:$.md,data:i})}};t.\u0275fac=function(n){return new(n||t)(C(fe),C(he),C(ue),C(Q))},t.\u0275cmp=B({type:t,selectors:[["app-purchases"]],viewQuery:function(n,m){if(n&1&&(T(y,5),T(S,5)),n&2){let u;E(u=O())&&(m.loadingDialog=u.first),E(u=O())&&(m.errorDialog=u.first)}},decls:5,vars:2,consts:[["class","mx-3 my-3",4,"ngIf"],["view","compras",3,"state",4,"ngIf"],[1,"mx-3","my-3"],[1,"mx-4","mt-5"],[1,"inline-flex-aligned"],["svgIcon","package-variant",1,"ml-3","mr-2"],["id","table-responsive"],["mat-table","",3,"dataSource"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","total"],["matColumnDef","payment-info"],["matColumnDef","products"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",1,"mt-3",3,"page","pageSizeOptions","length"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","primary",3,"click"],["svgIcon","package-variant"],["mat-header-row",""],["mat-row",""],["view","compras",3,"state"]],template:function(n,m){n&1&&(d(0,"app-navbar"),c(1,Re,27,6,"main",0)(2,Be,1,1,"app-loading-view",1),d(3,"app-error-dialog")(4,"app-loading-dialog")),n&2&&(s(),l("ngIf",m.viewState==="ready"),s(),l("ngIf",m.viewState!=="ready"))},dependencies:[H,J,K,y,S,A,L,q,U,Z,G,W,Y,ne,ee,X,ae,te,ie,re,oe,me,z,k,pe,le],styles:["mat-card[_ngcontent-%COMP%]{border-radius:25px;box-shadow:0 0 12px #0003}mat-card-content[_ngcontent-%COMP%]   #table-responsive[_ngcontent-%COMP%]{width:100%;overflow-x:scroll}.mat-column-payment-info[_ngcontent-%COMP%], .mat-column-total[_ngcontent-%COMP%], .mat-column-products[_ngcontent-%COMP%]{white-space:nowrap}.mat-column-actions[_ngcontent-%COMP%]{text-align:center;width:150px;white-space:nowrap}"]});let e=t;return e})();var Ne=[{path:"",component:Ce}],ge=(()=>{let t=class t{};t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=w({type:t}),t.\u0275inj=x({imports:[R.forChild(Ne),R]});let e=t;return e})();var lt=(()=>{let t=class t{};t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=w({type:t}),t.\u0275inj=x({imports:[F,ge,de,se]});let e=t;return e})();export{lt as PurchasesModule};
